# 数据仓库工具箱笔记
## 前言

* 这本书是维度建模的权威指南,但是由于书写的时间比较早,随着技术的不断更迭有些内容以及不适用了.不讨论当时技术在现在是否还适用,仅仅当经典概念来学习.
* 书中内容是根据不同的业务场景来逐步介绍维度模型的,这里总结就不按照书中的结构来记录了,仅仅记录自我认为比较合适的概念.
* 声明:本人是实习生,水平真的有限.酌情阅读,有理解错误欢迎指出.


## 基本概念了解

[基本概念](https://my.oschina.net/leejun2005/blog/188770)

## 1.初步认识 

### 数据获取和数据分析的区别

* 操作型系统保存数据;DW/BI使用数据.
* 操作型系统目的是更快的处理单个事务;DW/BI目的是更快的完成多个事务分析.
* 操作型系统不维护历史数据,只反映最新状态;DW/BI保存维护历史数据.

### 数据仓库的目标

* 易用性:简单,快捷.

> DW/BI系统的数据的内容易于理解,具有直观性,较短时间内将分析查询数据返回给用户.

* 一致性:数据必须就有一致性,具有一致性后才具有可信度.

> DW/BI系统的数据往往来自不同的数据源,需要进行一致性集成.

* 可变性:能够适应需求的变化.

> DW/BI系统要能够方便处理需求的无可避免的变化,在发生变化的时候仍能提供数据服务

* 支持决策:正确的支持决策.

> DW/BI最重要的输出是基于分析证据所产生的决策.注意,面向决策和面向财务的不同,面向决策是在一定程度上允许有误差的,面向财务则必须时刻准确.


### 维度建模简介

* 维度建模面向数据分析.
* 数据库中强调3NF,主要为了消除冗余.维度模型并不要求必须满足3NF.

#### 3NF模型和维度模型的区别

* 3NF模型
	* 规范化的3NF将数据划分为多个不同的实体,每个实体构成一个关系表
	* 大幅度减少数据冗余
	* 复杂度高,难以理解
	* 查询性能低
* 维度模型
	* 复杂度低,易于理解
	* 查询性能高
	* 灵活多变

#### 用于度量的事实表

* 事实表存储业务过程时间的性能度量结果.
* 尽量将来源于同一个业务过程的底层度量结果存储于一个维度模型中.
* 事实表示某个业务的度量.
* 事实表中的每行对应一个度量事件,同一张事实表中的所有度量行粒度相同.
* 度量数值类型
	* 可累加型事实,例如:销售额,可按照任意时间维度进行汇总.
	* 半可累加型事实,例如:账户余额,不能按照时间维度进行汇总,可按照时间均值.
	* 不可累加型事实,例如:单价.完全不能按照时间维度来做处理.
* 尽量不要将冗余文本信息(除唯一文本)放在事实表中,描述性冗余文本信息放入维度表中.对于事实表中的每个行来说,其文本都是唯一的.
* 不要将未发生的度量时间存入事实表.
* 事实表列少行多.
* 事实表类型
	* 事务型事实表
	* 周期快照型事实表
	* 累计快照型事实表
* 一般事实表具有多个外键与维度表的主键进行关联.
* 几个维度一起唯一标识一个事实表行.

#### 用于描述环境的维度表
* 维度表示度量时间的描述性信息.
* 维度表包含业务过程度量事件有关的文本环境.
* 维度表列多行少.
* 每个维度表由单一主键定义,用于在于事实表连接时作为参照完整性的基础.
* 数据库完整性:保证数据一致性,正确性,有效性
	* 参照完整性:要求关系中不允许引用不存在的实体.保证数据一致性和完整性.
	* 实体完整性:每个数据表必须有主键,唯一且非空.保证数据非空/唯一.
	* 域完整性:列必须满足某种特定的数据类型或约束.用户定义的完整性.
* 维度模型直接决定了数据仓库的好坏和OLAP的分析能力.
* 维度表通常具有层次关系,例如:日-周-月-年.这样做的目的是方便使用和提高查询性能.维度表通常不一定要满足第3范式,它常常是非规范化的,一个维度表往往存在多对一的关系.

#### 如何区分是维度还是事实?

* 描述性列
	* 该列数据是一种包含多个值并作为计算的参与者的度量,往往是事实.
		* 例如:产品的标价看起来像是一个产品的描述,但是它经常会发生变化,并且需要参与最终订单支付金额的计算,所以更可能是一种度量事实.
	* 该列是对具体值的描述,是一个常量/约束/行标识的参与者,往往是维度.
* 数字量
	* 连续值数字基本上可以任务属于事实.
	* 来自一个不太大的列表的离散数字基本可认为是维度属性.

#### 如何选择粒度

* 粒度最小的数据或原子数据具有最多的维度.尚未聚集的原子数据是最具有可表达性的数据.原子数据是构建能够满足用户提出任意查询的事实表的设计基础.同时也方便添加维度信息.

## 2.维度建模技术概要

### 4步骤维度设计过程
1. 选择业务过程:明确事实表要度量的事件是什么?
> 业务过程是由组织完成的微观活动.
> 
> 例如:获取订单,开具发票,学生注册,账户快照等
	* 业务过程特征
		1. 业务过程通常用行为动词表示,通常表示业务执行的活动
		2. 业务过程建立或获取关键性能度量
			* 建立关键性度量:学生注册,开具发票等
			* 获取关键性度量:获取订单,账户快照等
		3. 度量是业务过程的直接结果
		4. 一系列过程产生一些列事实表.

2. 声明粒度:定义事实表的每一行表示什么?
> 声明粒度意味着精确定义某个事实表的每一行表示什么.
> 
> 粒度传递的是与事实表度量有关的细节级别.
> 
> 例如:销售事务上每个销售订单一行,每个银行账户每个月一行.
	* 声明粒度是不容忽视的关键步骤,在构建维度模型前必须明确定义维度模型的粒度.

3. 确认维度:怎么描述业务过程度量事件?
> 维度表示承担每个度量环境中所有可能的单值描述符.
> 
> 应当使用健壮的维度集合来描述事实表.
> 
> 常见的维度有:日期,用户等.

4. 确认事实:过程的度量是什么?
> 确定事实表度量的指标.
> 
> 设计中多有获选事实必须符合第2步粒度的定义.
> 
> 明显不同粒度的事实必须放在不同的事实表中.

![维度设计4步过程的关键输入](https://github.com/zzhangyuhang/The-Data-Warehouse-Toolkit/photo/4步建模.png)
